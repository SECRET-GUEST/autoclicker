
#         ████████     ██████
#        █░░░░░░░░██_██░░░░░░█
#       █░░░░░░░░░░░█░░░░░░░░░█
#      █░░░░░░░███░░░█░░░░░░░░░█
#      █░░░░███░░░███░█░░░████░█
#    █░░░██░░░░░░░░███░██░░░░██
#   █░░░░░░░░░░░░░░░░░█░░░░░░░░███
#   █░░░░░░░░░░░░░██████░░░░░████░░█
#   █░░░░░░░░░█████░░░████░░██░░██░░█
#  ██░░░░░░░███░░░░░░░░░░█░░░░░░░░███
# █░░░░░░░░░░░░░░█████████░░█████████
#█░░░░░░░░░░█████ ████   ████ █████ █
#█░░░░░░░░░░█      █ ███   █   ███ █ █
#█░░░░░░░░░░░░█   ████ ████    ██ ████
#░░░░░░░░░░░░░█████████░░░████████░░░█
#░░░░░░░░░░░░░░░░█░░░░░█░░░░░░░░░░░░█
#░░░░░░░░░░░░░░░░░░░░██░░░░█░░░░░░██
#░░░░░░░░░░░░░░░░░░██░░░░░░░███████
#░░░░░░░░░░░░░░░░██░░░░░░░░░░█░░░░░█                                            _____                                 _____                                            _____                                                   _____
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                                          /\    \                               /\    \                                          /\    \                                                 /\    \
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                      ::                 /::\    \                             /::\    \                                        /::\____\                                               /::\____\
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█                                        /::::\    \                           /::::\    \           :::         ::           ::: ::/    /                         :                   :: ::/    /
#░░░░░░░░░░░█████████░░░░░░░░░░░░░░██                                       /::::::\    \                         /::::::\    \                               ::: : :::/    /                                              /:::/    /
#░░░░░░░░░░█▒▒▒▒▒▒▒▒███████████████▒▒█                                     /:::/\:::\    \                    :: ::::/\:::\    \                                  /:::/    /                                              /:::/    /
#░░░░░░░░░█▒▒███████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                                    /:::/__\:::\    \                     /:::/__\:::\    \                                /:::/    /                                            :::: :/____/
#░░░░░░░░░█▒▒▒█▓▓▓▓██████████████████                                    /::::\   \:::\    \                   /::::\   \:::\    \                              /:::/    /                                              /::::\    \
#░░░░░░░░░██▒▒█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                       /::::::\   \:::\    \                 /::::::\   \:::\    \                            /:       /      _____                                   /::::::\    \   _____
#░░░░░░░░░░█▒▒█▓█████████████████ ████                                 /:::/\:::\   \:::\ ___\               /:::/\:::\   \:::\____\                          /:::/____/      /\    \                                 /:::/\:::\    \ /\    \
#░░░░░░░░░░█▒▒██▓▓▒▓▒▓▒▓▒▒▒▒▒▒▒▒▓█▓▒▒▒█                               /:::/__\:::\   \:::|    |             /:::/  \:::\   \:::|    |                         :::|    /      /::\____\                        ::::::: :::/ : :::\    /::\____\
#░░░░░░░░░█▒▒████████▓▒███▓██▒▒▒▒▒▒▒▒▒█                  :            \:::\   \:::\  /:::|____|             \::/   |::::\  /:::|____|                      : :: :|____\     /:::/    /                               \::/    \:::\: ::::/    /
#░░░░░░░░░█▒▒▒▒▒▒▒▒▒█████████████▓█▓██                                 \:::\   \:::\/:::/    /               \/____|:::::\/:::/    /                          \:::\    \   /:::/    /                                 \/____/: :::\/:::/    /
#░░░░░░░░░░████████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                                  \:::\   \::::::/    /                      |:::::::::/    /                            \:::\   :: : ::/    /                                 :  :  : : :::::::/    /
#░░░░░░░░░░░░░░░░░░██████████████████                                    \:::\   \::::/    /          :  :         |::|\::::/    /           ::                 \:::\    /:::/    /               ::::                          \::       /
#░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░█            ::                           \:::\  /:::/    /                      :: ::| \::/____/                                \:::\__/:::/    /                                              /:::/    /
#██░░░░░░░░░░░░░░░░░░░░░░░░░░░██                                           \:::\/:::/    /                         |::|  ~|                                       \::::::::/    /                                             : :::/    /
#▓██░░░░░░░░░░░░░░░░░░░░░░░░██                                              \::::::/    /                          |::|   |                                        \::::::/    /                                              /:::/    /
#▓▓▓███░░░░░░░░░░░░░░░░░░░░█                                                 \::::/    /                           \::|   |                                         \::::/    /                              ::: :           /:::/    /
#▓▓▓▓▓▓███░░░░░░░░░░░░░░░██                                 :                 \::/____/            :                \:|   |               :    ::::                  \::/____/                                               \::/    /
#▓▓▓▓▓▓▓▓▓███████████████▓▓█                                                   ⠋                                     \|___|                                           ⠩                                                      \/____/
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                                                                                                                                                                                                                               |                                                                    |                                      |
#▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                                                                    |                                                                                                             |
#______________________________                                                                                                                       |                                                                                                                      |                                                                                                                                              |                    |
#___________________________
#_ ______ _____ _________
#/            /                                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                       |                    |
                
#       \                          |                                |                                               |  |                                          |                    |                                          |                       |                    |  |                                           |                    |        |                    |                              |
                

#     |               |                                 |
                
#                 |                                                |            |                                   |                               |                           |                               |                           |                               |                                |                               |
#          |                                  |                                     |
                
#                 |                     |                                                     |                                   |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#  |                          |                       |                    |
#          |                                    |                                         |     |                    |                                    | |     |                    |                                    | |     |                    |                                    |      |     |                                                        |
#     |                        |                                 |      |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                       |                    |
                
#                     |                                                |      |                                   |                               |                         |                               |                         |                               |                              |                               |
#          |                                   |                               |                   |                                |                       |                    |          |                                |                       |                    |          |                                |                       |                    |               |                                |                                        |
                
#                 |                     |
#  |                                |                       |                    |            |                                |                       |                    |     |                                |                       |                    |     |                                |                       |                              |                                |
#          |                               |                                         |                              |                       |                    |                           |                       |                    |                           |                       |                    |                                |                       |                    |
                
#  |         |                                   PRESENTATION                                                |                                |                    |   |                                |                    |   |                                |                    |        |                                |                    |
#                                                                                                                              |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#               |                             /                 \                          |                                                                              |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
                
#       |                               A log handler to configure for                    |                                           |               |                                           |               |                                           |                    |                                           |
                
#                          /                      |    v    |                    \
                
#                 your python programs, docs here : https://github.com/SECRET-GUEST/logInfo       |                                |                                          |      |                                |                                          |      |                                |                                          |           |                                |  
#     |                  !      |                                   |     |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                           |
#                               |                                   |     |                  
#                  |            |                   Anyway          !                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                    |
                
#             |                      |                 have                                                 |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                     |                                           |
                

#                |                                  FUN         |                        |                                         |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                                                      |
                
#                                                        =)
                
#
#                               |                      or                                       |                                                            |                    |                |                       |                    |                |                       |                    |                    |                                           |
                

#             |                              |       DIE ! ! !        |                       |                            |                |                       |                    |                |                       |                    |                    |                                           |#     |                        |                                         |                                |
                
#
#                                                    !                                       |                                |                    |  |                                |                    |  |                                |                    |       |                                |                    |
                
#     |               |                                 !
                
#                 |                                                |            |                                   |                               |                           |                               |                           |                               |                                |                               |
#          |                                  !                                     |
                
#                 |                     |                                                     |                                   |                               |     |                                   |                               |     |                                   |                               |          |                                   |                               |
#  |                          |                       |                    !
#          |                                    |                                         |     |                    |                                    | |     |                    |                                    | |     |                    |                                    |      |     |                    |                                    |
#     |                        |                                 |      |                                |                       |                    |                |                       |                    |                |                       |                    |                    |                                           |
                
#                     |                                                |      |                                   |                               |                         |                               |                         |                               |                              |                               |
#          |                                   |                               |                   |                                |                       |                    |          |                                |                       |                    |          |                                |                       |                    |               |                                                                |
              
#_ _  _ ____ ___ ____ _    _    ____ ___ _ ____ _  _
#| |\ | [__   |  |__| |    |    |__|  |  | |  | |\ |
#| | \| ___]  |  |  | |___ |___ |  |  |  | |__| | \|
   

import logging, os, sys,configparser
from Handlers.msgBox import FreeWill, tripleChoice, ThemeSelector

from PyQt5.QtWidgets import QMessageBox,QDialog
from PyQt5.QtCore import QObject, pyqtSignal


class logz(logging.Logger):
    def __init__(self, name, level=logging.NOTSET):
        super().__init__(name, level)

    @classmethod
    def configLogs(cls, logger_name, log_file_name, use_qt_dialogs=False):
        # Create a directory for the logs if it doesn't exist
        user_folder = os.path.expanduser('~')
        config_folder = os.path.join(user_folder, 'config autoclicker')
        os.makedirs(config_folder, exist_ok=True)

        log_file = os.path.join(config_folder, log_file_name)

        # Configure the logger with the given logger name and log file
        logger = cls(logger_name)
        logger.setLevel(logging.DEBUG)

        # Set the log message format
        formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')

        # Save logs to a file
        file_handler = logging.FileHandler(log_file)
        file_handler.setFormatter(formatter)
        logger.addHandler(file_handler)

        if use_qt_dialogs:
            # Display logs in QMessageBox dialogs
            qt_handler = logging.Handler()
            qt_handler.setFormatter(formatter)
            qt_handler.emit = lambda record: logger.show_error(None, qt_handler.format(record)) if record.levelno >= logging.ERROR else None
            logger.addHandler(qt_handler)
        else:
            # Display logs in the console
            console_handler = logging.StreamHandler()
            console_handler.setFormatter(formatter)
            logger.addHandler(console_handler)

        return logger



    @staticmethod
    #function to make an exe file with py to exe
    def ressource_path(relative_path):
        if getattr(sys, 'frozen', False):
            # The application is frozen (compiled)
            app_path = sys._MEIPASS
        else:
            # The application is not frozen (running from source)
            app_path = os.path.dirname(os.path.abspath(__file__))
        
        return os.path.join(app_path, relative_path)
    #to make it works, you have to rename all your path with ressource_path (/path/) WHEN YOU WILL TURN THE SCRIPT TO EXE
    #Example : /icon/lol.png  BECOME  ressource_path(/icon/lol.png)


#___  ____ ___     _  _ ___  ____ 
#|__] |  | |__]    |  | |__] [__  
#|    |__| |       |__| |    ___] 
                                 

    def show_choice(self, parent, message, action):
        free_will = FreeWill(parent, message, action)
        free_will.exec_and_call_action()
        
    def show_triple_Choice(self, parent, message, action_yes, action_no, custom_action_text, custom_action):
        loop_warning = tripleChoice(parent, message, action_yes, action_no, custom_action_text, custom_action)
        loop_warning.exec_and_call_actions()


    def show_error(self, parent, message):
        error_box = QMessageBox(parent)
        error_box.setIcon(QMessageBox.Critical)
        error_box.setWindowTitle("Error")
        error_box.setText(message)
        error_box.exec_()

    def show_theme_selector(self, parent):
        theme_selector = ThemeSelector(parent)
        result = theme_selector.exec_()
        if result == QDialog.Accepted:
            selected_theme = theme_selector.button_group.checkedId()
            return selected_theme
        return None



#____ ____ _  _ ____ _ ____ _  _ ____ ____ ___ _ ____ _  _    _  _ ____ _  _ ___  _    ____ ____ 
#|    |  | |\ | |___ | | __ |  | |__/ |__|  |  | |  | |\ |    |__| |__| |\ | |  \ |    |___ |__/ 
#|___ |__| | \| |    | |__] |__| |  \ |  |  |  | |__| | \|    |  | |  | | \| |__/ |___ |___ |  \ 
                                                                                                




    # Load the configuration file and read the 'last_theme' value from it
    def load_config(self):
        user_folder = os.path.expanduser('~')
        config_folder = os.path.join(user_folder, 'config autoclicker')
        os.makedirs(config_folder, exist_ok=True)
        config_file_path = os.path.join(config_folder, 'config.ini')

        # Create a ConfigParser object and read the configuration file
        config = configparser.ConfigParser()
        config.read(config_file_path)

        # If the 'Settings' section does not exist, add it to the configuration file
        if 'Settings' not in config.sections():
            config.add_section('Settings')

        # If 'last_theme' does not exist in the 'Settings' section, set it to 5 and write it to the configuration file
        if 'last_theme' not in config['Settings']:
            config.set('Settings', 'last_theme', '5')
            with open(config_file_path, 'w') as configfile:
                config.write(configfile)

        # Get the value of 'last_theme' as an integer and return it
        return config.getint('Settings', 'last_theme')

    # Save the selected theme to the configuration file
    def save_config(self, theme):
        user_folder = os.path.expanduser('~')
        config_folder = os.path.join(user_folder, 'config autoclicker')
        os.makedirs(config_folder, exist_ok=True)
        config_file_path = os.path.join(config_folder, 'config.ini')

        # Create a ConfigParser object and read the configuration file
        config = configparser.ConfigParser()
        config.read(config_file_path)

        # If the 'Settings' section does not exist, add it to the configuration file
        if 'Settings' not in config.sections():
            config.add_section('Settings')  

        # Set the value of 'last_theme' to the selected theme and write it to the configuration file
        config.set('Settings', 'last_theme', str(theme))
        with open(config_file_path, 'w') as configfile:
            config.write(configfile)






#___ _  _ ____ _  _ ____    ___  _ ____ ___  ____ ___ ____ _  _ ____ ____ 
# |  |__| |___ |\/| |___    |  \ | [__  |__] |__|  |  |    |__| |___ |__/ 
# |  |  | |___ |  | |___    |__/ | ___] |    |  |  |  |___ |  | |___ |  \ 


    def update_theme(self, window, theme=None):
        if theme is None:
            theme = 1  # set the default theme to 1

        # update the window's title to include the name of the current theme
        current_theme_name = f"Thème {theme}"

        if window is not None:
            window.setWindowTitle(f"Lemme do it 4 U 🥺 - {current_theme_name}")

            # load and apply the stylesheet for the current theme
            stylesheet_path = self.ressource_path(f"styles/style{theme}.txt")
            with open(stylesheet_path) as file:
                window.setStyleSheet(file.read())


    def apply_theme_to_all_windows(self, theme, *windows):
        for window in windows:
            self.update_theme(window, theme)

    def change_theme(self, mainWindow, theme_changed_signal=None):
        # show the theme selector dialog box
        theme_selector = ThemeSelector(mainWindow, self)

        # connect the theme_selector's theme_selected signal to the lambda function
        theme_selector.theme_selected.connect(lambda selected_theme: self.apply_theme_to_all_windows(selected_theme, mainWindow))

        # connect the theme_changed_signal to the theme_selector's theme_selected signal
        if theme_changed_signal is not None:
            theme_selector.theme_selected.connect(theme_changed_signal.theme_changed)

        result = theme_selector.exec_()
        if result == QDialog.Accepted:
            selected_theme = theme_selector.selected_theme
            self.save_config(selected_theme)


    def initialize_theme(self, mainWindow, windowCeption=None):
        # load the last-used theme from the config file
        last_theme = self.load_config() 

        # update the theme for both windows
        self.apply_theme_to_all_windows(last_theme, mainWindow, windowCeption)  


    class ThemeChangedSignal(QObject): #Emit signal for the title bar
        theme_changed = pyqtSignal(int) 
